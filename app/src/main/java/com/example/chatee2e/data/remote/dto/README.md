# Пакет: com.example.chatee2e.data.remote.dto

Даний пакет містить об'єкти передачі даних (**Data Transfer Objects**), які визначають структуру документів у хмарній базі даних Firebase Firestore. Цей шар є критично важливим для мережевої взаємодії, оскільки він описує формат зашифрованих пакетів, що циркулюють між клієнтами через сервер.

## Основні компоненти (DTO моделі)

### 1. ChatDto
Описує структуру документа в колекції `chats`.
* **name**: назва чату (для групових чатів).
* **ownerId**: ідентифікатор користувача, який створив чат.
* **isGroup**: прапорець, що визначає тип кімнати (особиста чи групова).
* **participantIds**: список ідентифікаторів користувачів, які мають доступ до цього чату. Цей список використовується правилами безпеки Firestore для обмеження доступу.

### 2. MessageDto
Ключова модель для реалізації наскрізного шифрування (E2EE) в колекції `messages`.
* **chatId**: прив'язка повідомлення до конкретного ідентифікатора чату.
* **senderId**: ідентифікатор відправника повідомлення.
* **timestamp**: мітка часу, що генерується на стороні сервера (`@ServerTimestamp`), що гарантує синхронізацію часу між різними пристроями.
* **encryptedContent**: основний текст повідомлення, зашифрований алгоритмом AES-256 GCM та закодований у формат Base64.
* **iv**: вектор ініціалізації (Initialization Vector), необхідний для дешифрування повідомлення.
* **encryptedKeys**: карта (`Map`), де ключем є `userId`, а значенням — сесійний ключ AES, зашифрований публічним ключем RSA відповідного користувача.



### 3. UserDto
Описує профіль користувача в колекції `users`.
* **username / email**: ідентифікаційні дані користувача.
* **publicKey**: публічний ключ RSA (Base64), який використовується іншими учасниками для шифрування сесійних ключів повідомлень, що надсилаються цьому користувачу.

### 4. InviteDto
Модель для управління запитами на створення чату в підколекції `invites`.
* **senderId / receiverId**: ідентифікатори сторін, що взаємодіють.
* **chatId**: посилання на чат, до якого запрошується користувач.
* **timestamp**: час відправлення запиту.

## Технічні особливості та алгоритми

### Структура зашифрованого пакету
Система не зберігає відкритих даних у `MessageDto`. Сервер Firestore отримує об'єкт, де контент уже зашифрований клієнтом. Роль сервера зводиться до маршрутизації повідомлень учасникам, список яких вказаний у `ChatDto`.



### Синхронізація часу
Використання анотації `@ServerTimestamp` у моделях `MessageDto` та `InviteDto` є архітектурним рішенням для запобігання маніпуляціям із часом на боці клієнта та забезпечення правильної хронології повідомлень незалежно від часових поясів пристроїв.

### Обмін ключами (Multi-recipient support)
Поле `encryptedKeys` у `MessageDto` дозволяє одному повідомленню бути розшифрованим декількома учасниками (у групових чатах). Відправник шифрує один і той самий сесійний ключ AES різними публічними ключами отримувачів і додає їх у цю карту. Кожен отримувач вилучає лише той ключ, який відповідає його `uid`.

## Вплив на безпеку системи
Ці моделі спроектовані таким чином, щоб сервер (Firebase) не мав доступу до приватних ключів або відкритого тексту. Структура `MessageDto` гарантує, що навіть при повному доступі до бази даних, зловмисник побачить лише набір зашифрованих рядків та метадані, не маючи технічної можливості дешифрувати вміст без приватних ключів, що зберігаються в Android KeyStore користувачів.