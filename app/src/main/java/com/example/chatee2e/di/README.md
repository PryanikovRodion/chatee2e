# Пакет: com.example.chatee2e.di

Даний пакет реалізує механізм впровадження залежностей (Dependency Injection) з використанням бібліотеки **Hilt** (на базі Dagger 2). Він визначає спосіб створення, конфігурації та розповсюдження ключових об'єктів застосунку, забезпечуючи низьку зв'язність компонентів (Loose Coupling) та полегшуючи тестування.

## Модулі та конфігурація

### 1. AppModule (Провайдер зовнішніх залежностей)
Використовується для надання екземплярів класів, які не належать проєкту безпосередньо (сторонні бібліотеки) або вимагають складної ініціалізації.
* **Firebase Services**: Надає Singleton-екземпляри `FirebaseAuth` та `FirebaseFirestore` для мережевої взаємодії.
* **SharedPreferences**: Конфігурує системне сховище налаштувань під назвою `chatee2e_prefs` у приватному режимі.
* **CryptoManager**: Пов’язує інтерфейс `CryptoManager` з його реалізацією `CryptoManagerImpl`.
* **Database (Room + SQLCipher)**:
    * Виконує завантаження нативної бібліотеки `sqlcipher`.
    * **Критична логіка**: вимагає наявності `databasePassphrase` у `SessionManager` перед ініціалізацією бази даних.
    * Використовує `SupportOpenHelperFactory` для прозорого шифрування всього файлу SQLite.
* **DAO Access**: Надає доступ до `ChatDao` та `MessageDao`, використовуючи `dagger.Lazy<AppDatabase>`. Це запобігає передчасному створенню бази даних до того, як буде введений пароль розшифрування.

### 2. RepositoryModule (Зв'язування абстракцій)
Цей модуль є абстрактним і використовує анотацію `@Binds` для пов'язування інтерфейсів репозиторіїв з їхніми конкретними реалізаціями в шарі `data`.
* **AuthRepository**: Пов'язує інтерфейс із `AuthRepositoryImpl`.
* **ChatRepository**: Пов'язує інтерфейс із `ChatRepositoryImpl`.
* **MessageRepository**: Пов'язує інтерфейс із `MessageRepositoryImpl`.
* **UserRepository**: Пов'язує інтерфейс із `UserRepositoryImpl`.

## Технічні особливості та життєвий цикл

1. **SingletonComponent**: Всі залежності в обох модулях ініціалізуються в контексті `SingletonComponent`, що означає, що вони існують в єдиному екземплярі протягом усього часу роботи застосунку.
2. **Відкладена ініціалізація (Lazy Initialization)**: Використання `dagger.Lazy` при ініціалізації DAO є архітектурним рішенням для підтримки безпеки. Оскільки база даних зашифрована, Room не може бути створений до того, як користувач пройде автентифікацію і ключ буде отримано з Android KeyStore.
3. **Context Injection**: За допомогою анотації `@ApplicationContext` модулі отримують доступ до системного контексту Android, що необхідно для роботи з файловою системою (бази даних) та налаштуваннями.

## Роль у безпеці системи
Конфігурація у цьому пакеті гарантує, що жоден компонент застосунку не зможе отримати доступ до бази даних в обхід криптографічних перевірок. Впровадження `AppDatabase` через фабрику SQLCipher забезпечує, що всі дані, які проходять через DAO, автоматично зашифровуються перед записом на диск.